!function(){"use strict";if(U.canvasSupport){var e=function(e){var a,o,i,c,d,l,s,m,r=function(){a=document.createElement("div"),a.className="modal",document.body.appendChild(a),o=document.createElement("div"),o.className="modal-inner",a.appendChild(o),i=document.createElement("div"),i.className="modal-content",o.appendChild(i),i.style.opacity=0,c=document.createElement("p"),c.className="meditate-modal-img",i.appendChild(c),d=document.createElement("img"),d.src="/assets/img/icons/icon_meditate.png",c.appendChild(d),l=document.createElement("p"),l.className="meditate-modal-p",l.innerHTML="Thank you for meditating. Now saving...",i.appendChild(l),s=document.createElement("p"),s.className="modal-link",i.appendChild(s),m=document.createElement("a"),m.className="link-button",m.innerHTML="Cancel",s.appendChild(m);var e=0,t=setInterval(function(){e+=.1,i.style.opacity=e,e>=1&&(i.style.opacity=1,clearInterval(t))},20);U.addEvent(m,"click",p)};r();var p=function(){var e=1,t=setInterval(function(){e-=.1,a.style.opacity=e,0>=e&&(clearInterval(t),a.parentNode.removeChild(a))},20)},u=U.getAjaxObject();u.onreadystatechange=function(){4==u.readyState&&(u.status>=200&&u.status<300||304==u.status?(a.parentNode.removeChild(a),"LOGIN"==u.responseText?n():t()):U.log("Ajax error"))},u.open("POST","http://yogitimer.com/meditate",!0),u.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),u.send(e.join("&"))},t=function(){var e,t,n,a,o,i,c,d,l=function(){e=document.createElement("div"),e.className="modal",document.body.appendChild(e),e.style.background="rgba(56, 52, 69, 0.9)",t=document.createElement("div"),t.className="modal-inner",e.appendChild(t),n=document.createElement("div"),n.className="modal-content",t.appendChild(n),n.style.opacity=0,a=document.createElement("p"),a.className="meditate-modal-img",n.appendChild(a),o=document.createElement("img"),o.src="/assets/img/icons/icon_meditate.png",a.appendChild(o),i=document.createElement("p"),i.className="meditate-modal-p",i.innerHTML="This meditation has been added to your journal.",n.appendChild(i),c=document.createElement("p"),c.className="modal-link",n.appendChild(c),d=document.createElement("a"),d.className="link-button",d.innerHTML="Close",c.appendChild(d);var l=0,m=setInterval(function(){l+=.1,n.style.opacity=l,l>=1&&(n.style.opacity=1,clearInterval(m))},20);U.addEvent(d,"click",s)},s=function(){var t=1,n=setInterval(function(){t-=.1,e.style.opacity=t,0>=t&&(clearInterval(n),e.parentNode.removeChild(e))},20)};l()},n=function(){var e,t,n,a,o,i,c,d,l,s,m=function(){e=document.createElement("div"),e.className="modal",document.body.appendChild(e),e.style.background="rgba(56, 52, 69, 0.9)",t=document.createElement("div"),t.className="modal-inner",e.appendChild(t),n=document.createElement("div"),n.className="modal-content",t.appendChild(n),n.style.opacity=0,a=document.createElement("p"),a.className="meditate-modal-img",n.appendChild(a),o=document.createElement("img"),o.src="/assets/img/icons/icon_meditate.png",a.appendChild(o),i=document.createElement("p"),i.className="meditate-modal-p",i.innerHTML="Thank you for meditating. Login or sign up to save this meditation to your journal.",n.appendChild(i),c=document.createElement("p"),c.className="modal-link",n.appendChild(c),d=document.createElement("a"),d.className="link-button",d.href="/login",d.innerHTML="Login",c.appendChild(d),l=document.createElement("a"),l.className="link-button",l.href="/signup",l.innerHTML="Sign Up",c.appendChild(l),s=document.createElement("a"),s.className="link-button",s.innerHTML="Close",c.appendChild(s),U.addEvent(s,"click",r);var m=0,p=setInterval(function(){m+=.1,n.style.opacity=m,m>=1&&(n.style.opacity=1,clearInterval(p))},20)},r=function(){var t=1,n=setInterval(function(){t-=.5,e.style.opacity=t,0>=t&&(clearInterval(n),e.parentNode.removeChild(e))},20)};m()},a=function(t){"undefined"==typeof t&&(t=window.event);var n,a,o,i,c,d,l,s,m,r,p,u,h,v,g,f=new Audio("/assets/aud/gong."+U.supportedAudioFormat()),y={},C={},E=0,N={practice:null,sections:{},gong:null},I=0,b=-1,M=0,_=!1,k=!1,T=function(){for(var e=document.forms[0].elements,t=0,n=e.length;n>t;t++){var a=e[t].name;if("practice"==a)N.practice=e[t].value;else if("gong"==a)N.gong=e[t].value;else{if("submit"==e[t].type)continue;var o=a.substr(9,1),i=a.substr(13,4),c=e[t].value;"undefined"==typeof N.sections[o]&&(N.sections[o]={}),N.sections[o][i]=c,"time"==i&&(E+=60*c,I++)}}},w=function(){n=document.createElement("div"),n.className="modal",document.body.appendChild(n),n.style.opacity=0,a=document.createElement("div"),a.className="modal-inner",n.appendChild(a),o=document.createElement("canvas"),o.className="meditate-canvas",a.appendChild(o),i=o.getContext("2d"),c=document.createElement("p"),c.className="meditate-link",a.appendChild(c),d=document.createElement("a"),d.className="link-button",d.innerHTML="End",c.appendChild(d),U.addEvent(d,"click",function(){k=!0});var e=0,t=setInterval(function(){e+=.1,n.style.opacity=e,e>=1&&(n.style.opacity=1,clearInterval(t))},20)},H=function(){var e=window.innerWidth||document.documentElement.clientWidth||document.getElementsByTagName("body")[0].clientWidth,t=window.innerHeight||document.documentElement.clientHeight||document.getElementsByTagName("body")[0].clientHeight,n=c.innerWidth||c.clientHeight,a=t-n;u=Math.max(20,.04*a),a-=3*u,l=e,o.height=a,o.width=l,m=l/2,r=a/2;var i=Math.min(l/2-2*u,a/2-2*u);p=i-1,"Preparation"==N.sections[0].name&&N.sections[0].time>0&&(y.degrees=D(60*N.sections[0].time),y.arc_start=Math.PI/180*-90,y.arc_end=Math.PI/180*(y.degrees-90),y.x_start=m,y.y_start=r-p),"Cool Down"==N.sections[2].name&&N.sections[2].time>0&&(C.degrees=D(60*N.sections[2].time),C.arc_start=Math.PI/180*(270-C.degrees),C.arc_end=Math.PI/180*270,C.x_start=m+Math.cos(C.arc_start)*p,C.y_start=r+Math.sin(C.arc_start)*p)},P=function(){H(),L(),R()};U.addEvent(window,"resize",P);var L=function(){i.clearRect(0,0,l,s),i.beginPath(),i.strokeStyle="#AD9E99",i.fillStyle="#D0CFD7",i.lineWidth=4,i.arc(m,r,p,0,Math.PI/180*360,!1),i.stroke(),i.fill(),i.closePath()},R=function(){y.degrees>0&&x(y.arc_start,y.arc_end,y.x_start,y.y_start,"#746F88"),C.degrees>0&&x(C.arc_start,C.arc_end,C.x_start,C.y_start,"#746F88");var e=D(v);x(Math.PI/180*-90,Math.PI/180*(e-90),m,r-p,"#383445")},x=function(e,t,n,a,o){i.beginPath(),i.fillStyle=o,i.arc(m,r,p,e,t,!1),i.lineTo(m,r),i.lineTo(n,a),i.fill(),i.closePath()},D=function(e){return 360*(e/E)},S=function(e){g=N.sections[e].name,M+=60*N.sections[e].time},j=function(){(-1==b||v>M)&&(b++,S(b),W())},W=function(){null!=f&&("all"==N.gong||"meditation"==N.gong&&1==b)&&f.play()},A=function(){_=!0,h=new Date;var e=setInterval(function(){var t=new Date;v=(t-h)/1e3,(v>=E||1==k)&&(clearInterval(e),F()),j(),L(),R()},20)},F=function(){n.parentNode.removeChild(n);var t=v-(60*N.sections[0].time+60);if(t>0){var a=[];a.push(encodeURIComponent("practice")+"="+encodeURIComponent(N.practice)),a.push(encodeURIComponent("start_time")+"="+encodeURIComponent(h.getTime())),a.push(encodeURIComponent("gong")+"="+encodeURIComponent(N.gong));for(var o=0,i=0;I>i;i++)a.push(encodeURIComponent("sections["+i+"][name]")+"="+encodeURIComponent(N.sections[i].name)),a.push(encodeURIComponent("sections["+i+"][time]")+"="+encodeURIComponent(Math.min(N.sections[i].time,Math.max(0,(v-o)/60)))),o+=60*N.sections[i].time;e(a)}},O=function(){T(),w(),H(),L(),A()};return O(),t.preventDefault?t.preventDefault():t.returnValue=!1,!1},o=function(){var e=U.$("meditate-message-saved");null!=e&&e.parentNode.removeChild(e)};window.onload=function(){var e=document.forms[0];U.addEvent(e,"submit",o),U.addEvent(e,"submit",a)}}}();